{% extends "base.html" %}
{% load static %}

{% block title %}Admin - Ressourcerie{% endblock %}

{% block header %}
<nav class="site-header">
    <div class="site-header__container">
        <a href="{% url 'public_home' %}" class="site-header__logo">
            <img src="{% static 'images/logo-ressourcerie.png' %}" alt="Ressourcerie" class="site-header__logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
            <span class="site-header__logo-text">Ressourcerie</span>
        </a>
        <div class="site-header__actions">
            <a href="{% url 'public_home' %}" class="site-header__link">Voir le site</a>
            <a href="{% url 'admin_logout' %}" class="site-header__link">Déconnexion</a>
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<header class="top-hero top-hero--admin">
    <div class="top-hero__overlay"></div>
    <div class="top-hero__content">
        <h1 class="screen-title">Nouvelle publication</h1>
        <p class="screen-subtitle">Ajoutez rapidement un produit à la ressourcerie.</p>
    </div>
</header>

<main class="screen screen--with-hero">
    <div class="dashboard-layout">
        <section class="card card--elevated card--form">
            <form method="post" enctype="multipart/form-data" class="form" novalidate>
                {% csrf_token %}

                <div class="form-group">
                    <label class="label">Photo du produit</label>
                    <div class="upload-block">
                        {{ form.image }}
                        <p class="upload-helper">Formats acceptés : JPG, PNG. Taille conseillée : paysage.</p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="label" for="{{ form.image_alt.id_for_label }}">Texte alternatif</label>
                    {{ form.image_alt }}
                </div>

                <div class="form-group">
                    <label class="label" for="{{ form.category.id_for_label }}">Catégorie</label>
                    {{ form.category }}
                </div>

                <div class="form-group">
                    <label class="label" for="{{ form.title.id_for_label }}">Titre de la publication</label>
                    {{ form.title }}
                </div>

                <div class="form-group">
                    <label class="label" for="{{ form.description.id_for_label }}">Description</label>
                    {{ form.description }}
                </div>

                <div class="form-group">
                    <label class="label" for="{{ form.dimensions.id_for_label }}">Dimensions</label>
                    {{ form.dimensions }}
                </div>

                <div class="form-group form-group--inline">
                    <label class="label label--inline" for="{{ form.is_published.id_for_label }}">Afficher sur le site public</label>
                    {{ form.is_published }}
                </div>

                <button type="submit" class="btn btn-primary btn-full">Publier le produit</button>
            </form>
        </section>

        <section class="section">
            <h2 class="section-title">Dernières publications</h2>
            <div class="cards-list">
                {% for product in latest_products %}
                    <article class="card card--compact">
                        <div class="card__thumb">
                            {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.image_alt|default:product.title }}">
                            {% endif %}
                        </div>
                        <div class="card__body">
                            <h3 class="card__title">{{ product.title }}</h3>
                            {% if product.dimensions %}
                                <p class="card__meta">{{ product.dimensions }}</p>
                            {% endif %}
                            <p class="card__meta">{{ product.get_category_display }}</p>
                            <p class="card__date">Créé le {{ product.created_at|date:"d/m/Y H:i" }}</p>
                        </div>
                        <form method="post" action="{% url 'admin_delete_product' product.id %}" class="card__delete-form" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette publication ?');">
                            {% csrf_token %}
                            <button type="submit" class="btn-delete" aria-label="Supprimer {{ product.title }}">×</button>
                        </form>
                    </article>
                {% empty %}
                    <p class="empty-state-text">Aucune publication pour le moment.</p>
                {% endfor %}
            </div>
        </section>
    </div>
</main>
{% endblock %}

